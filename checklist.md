# 구매 영수증 매칭 자동화 구현 계획서

## 프로젝트 개요
카카오톡으로 받은 영수증 이미지와 개인정보를 엑셀 구매 데이터와 매칭하여 자동으로 처리하는 시스템

## 전체 아키텍처
```
[관리자 입력] → [OCR 처리] → [개인정보 추출] → [엑셀 매칭] → [데이터 업데이트]
```

## 단계별 구현 체크포인트

### Phase 1: 핵심 기능 검증 (1-2주)

#### Checkpoint 1.1: OCR 기능 구현 및 테스트
- [ ] **목표**: 영수증 이미지에서 텍스트 추출
- [ ] **기술**: Python + Tesseract OCR 또는 Google Vision API
- [ ] **구현 범위**:
  - 이미지 파일 읽기 기능
  - OCR 텍스트 추출 기능
  - 추출 결과 정확도 평가
- [ ] **테스트 데이터**: 실제 영수증 이미지 5-10개
- [ ] **성공 기준**: 구매 시각, 금액, 매장명 추출 정확도 70% 이상
- [ ] **리스크**: 이미지 품질에 따른 OCR 정확도 편차

#### Checkpoint 1.2: GPT-5 API 개인정보 추출 테스트
- [ ] **목표**: 비정형 텍스트에서 이름/전화번호/주소 추출
- [ ] **기술**: OpenAI GPT-5-nano API
- [ ] **구현 범위**:
  - API 연동 및 프롬프트 설계
  - JSON 형태 응답 파싱
  - 추출 결과 검증 로직
- [ ] **테스트 데이터**: 제공된 실제 개인정보 텍스트 샘플
- [ ] **성공 기준**: 추출 정확도 95% 이상
- [ ] **비용 추정**: 테스트 단계에서 월 $5 이하

#### Checkpoint 1.3: 엑셀 파일 조작 기능
- [ ] **목표**: 엑셀 파일 읽기/쓰기/수정 기능
- [ ] **기술**: Python + openpyxl 또는 pandas
- [ ] **구현 범위**:
  - 엑셀 파일 읽기 및 구조 파악
  - 특정 행/열에 데이터 추가
  - 수정된 파일 저장
- [ ] **테스트 데이터**: 샘플 구매 정보 엑셀 파일
- [ ] **성공 기준**: 데이터 손실 없이 정확한 위치에 정보 추가

### Phase 2: 매칭 로직 개발 (1-2주)

#### Checkpoint 2.1: 영수증-엑셀 매칭 알고리즘
- [ ] **목표**: 영수증 정보와 엑셀 데이터 매칭
- [ ] **매칭 기준**:
  - 구매 시각 (±30분 오차 허용)
  - 구매 금액 (정확히 일치)
  - 구매 항목/매장명 (부분 매칭)
- [ ] **구현 범위**:
  - 시간 형식 정규화 및 비교
  - 금액 형식 정규화 및 비교
  - 문자열 유사도 매칭 (fuzzywuzzy 등)
- [ ] **성공 기준**: 매칭 정확도 90% 이상
- [ ] **예외 처리**: 매칭 실패 시 수동 확인 요청

#### Checkpoint 2.2: 중복 처리 및 예외 상황 대응
- [ ] **목표**: 동일 시간대 중복 구매, 매칭 실패 등 처리
- [ ] **구현 범위**:
  - 다중 매칭 후보 발견 시 처리 로직
  - 매칭 실패 시 알림 기능
  - 이미 처리된 데이터 중복 방지
- [ ] **성공 기준**: 예외 상황 100% 감지 및 적절한 알림

### Phase 3: 통합 및 UI 개발 (1-2주)

#### Checkpoint 3.1: 간단한 GUI 또는 CLI 인터페이스
- [ ] **목표**: 관리자가 쉽게 사용할 수 있는 인터페이스
- [ ] **기술**: 
  - CLI: Python argparse
  - GUI: Tkinter 또는 PyQt
  - 웹: Flask/Streamlit (선택적)
- [ ] **구현 범위**:
  - 영수증 이미지 업로드
  - 개인정보 텍스트 입력
  - 처리 결과 확인
  - 엑셀 파일 선택 및 저장
- [ ] **성공 기준**: 비개발자도 5분 내 사용법 습득 가능

#### Checkpoint 3.2: 전체 워크플로우 통합 테스트
- [ ] **목표**: 전체 프로세스 end-to-end 테스트
- [ ] **테스트 시나리오**:
  - 정상 케이스: 영수증 + 개인정보 → 엑셀 업데이트
  - 예외 케이스: OCR 실패, 매칭 실패, API 오류 등
- [ ] **성공 기준**: 전체 프로세스 성공률 85% 이상

### Phase 4: 안정성 및 최적화 (1주)

#### Checkpoint 4.1: 오류 처리 및 로깅
- [ ] **목표**: 안정적인 운영을 위한 오류 처리
- [ ] **구현 범위**:
  - 각 단계별 오류 로깅
  - API 호출 실패 시 재시도 로직
  - 사용자 친화적 오류 메시지
- [ ] **성공 기준**: 모든 오류 상황에서 적절한 메시지 제공

#### Checkpoint 4.2: 성능 최적화 및 비용 관리
- [ ] **목표**: 처리 속도 향상 및 API 비용 절약
- [ ] **구현 범위**:
  - 배치 처리 기능 (여러 건 동시 처리)
  - API 호출 최적화 (캐싱, 요청 압축)
  - 프로그레스 바 및 상태 표시
- [ ] **성공 기준**: 건당 처리 시간 30초 이내, 월 API 비용 $10 이하

## 기술 스택 권장사항

### 필수 라이브러리
```python
# OCR 처리
tesseract-ocr  # 또는 google-cloud-vision

# 엑셀 처리
openpyxl
pandas

# API 통신
openai
requests

# 문자열 매칭
fuzzywuzzy
python-Levenshtein

# GUI (선택적)
tkinter  # 또는 streamlit
```

### 프로젝트 구조
```
automation_app/
├── main.py              # 메인 실행 파일
├── modules/
│   ├── ocr_processor.py     # OCR 처리
│   ├── info_extractor.py    # 개인정보 추출
│   ├── excel_handler.py     # 엑셀 조작
│   ├── matcher.py           # 매칭 로직
│   └── utils.py             # 유틸리티 함수
├── config/
│   ├── settings.py          # 설정값
│   └── prompts.py           # GPT 프롬프트
├── tests/
│   └── test_samples/        # 테스트 데이터
└── logs/                    # 로그 파일
```

## 리스크 관리

### 높은 리스크
1. **OCR 정확도**: 영수증 이미지 품질에 따른 편차
   - **대응**: 다중 OCR 엔진 사용, 전처리 개선
2. **매칭 오류**: 잘못된 구매자 특정
   - **대응**: 신뢰도 점수 도입, 수동 확인 단계

### 중간 리스크
1. **API 비용**: 예상보다 높은 GPT API 사용량
   - **대응**: 로컬 모델 대안 준비, 사용량 모니터링
2. **데이터 형식 변경**: 엑셀 구조나 영수증 형식 변경
   - **대응**: 설정 파일로 유연한 구조 지원